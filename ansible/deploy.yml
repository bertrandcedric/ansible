---
# Gather facts to be able to use them in next plays
- hosts: all
  gather_facts: yes
  remote_user: deploy

- hosts: all
  gather_facts: no
  remote_user: deploy
  roles:
#    - { role: test }
    - { role: mongodb/commons, tags: [commons, replica, config, sharding] }

#################################
# Creation de la config replica #
#################################
- hosts: replica
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/replica, tags: [replica] }

- hosts: client
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/client/replica, tags: [replica]  }

#########################
# Creation de la config #
#########################
- hosts: config
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/config, tags: [config] }

- hosts: client
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/client/config, tags: [config] }

########################
# Creation du sharding #
########################
- hosts: sharding
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/shard, tags: [sharding] }

- hosts: client
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/client/sharding, tags: [sharding] }

#############
# Test data #
#############
- hosts: client
  gather_facts: no
  remote_user: deploy
  roles:
    - { role: mongodb/client/test, tags: [test] }
