<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Ansible</title>
		<meta name="description" content="Documentation">
		<meta name="author" content="CBE">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moon.css" id="theme">
		<link rel="stylesheet" href="lib/css/zenburn.css">
        <style>
        html.ansible_logo div.slide-background.present {
            background-position: right top;
            background-size: 100px;
        }
        html.bottom div.slide-background.present {
            background-position: bottom;
        }
        </style>
		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	<body>
        <!--<div id="myLogo" style="-->
            <!--background-image: url(images/ansible.png);-->
            <!--position: absolute;-->
            <!--bottom: 85%;-->
            <!--right: 2%;-->
            <!--width: 100px;-->
            <!--height: 100px;-->
            <!--z-index: 999999;-->
            <!--">-->
        <!--</div>-->
		<div class="reveal">
			<div class="slides">
                <section data-markdown>
                    <script type="text/template">
                        ##Ansible

                        Comment le développeur reprend le pouvoir sur la production
                    </script>
				</section>
                <section data-markdown>
                    <script type="text/template">
                        ## Presentation

                        * En bref
                        * Présentation des concepts
                        * Ansibox pour le développeur
                        * Démo => Déploiement d'un cluster Mongodb avec Ansible
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## En bref

                        * D'après la documentation Ansible officielle :

                        *Ansible is an IT automation tool. It can configure systems, deploy software, and orchestrate more advanced IT tasks such as continuous deployments or zero downtime rolling updates.*
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## En bref

                        Placer Ansible par rapport aux autres outils (Puppet/Chef/Salt ...)

                        TODO
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## En bref

                        * Outil de la mouvance DevOps
                        * Sans agent
                        * S'appuie sur SSH comme protocole de communication
                        * S'appuie sur le sytème de templating Jinja2
                        * Script / Ansible = Ant / Maven
                    </script>
                </section>
                <section data-markdown data-background="images/comment_ca_marche.png" data-background-size="800px">
                    <script type="text/template">
                        ## En bref
                    </script>
                </section>
                <section data-markdown data-background="images/comment_ca_marche_1.png" data-background-size="800px">
                    <script type="text/template">
                        ## En bref
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Concepts de base

                        TODO : Présentation des échanges entre machine + problèmatiques de clef ssh
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Concepts de base

                        - L'inventaire
                        - Playbooks et tâches
                        - Module
                </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Fichier d'inventaire

                        * Contient la liste des hosts managés
                        * Organisé en hosts et groups
                        * Un host peut appartentir à plusieurs groups

                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Fichier d'inventaire

                        ```
                        [local]
                        127.0.0.1 ansible_connection=local

                        [requirement]
                        10.121.211.2 ansible_ssh_pass={{user_password}} //
                        ansible_sudo_pass={{user_password}}
                        10.121.211.3 ansible_ssh_pass={{user_password}} //
                        ansible_sudo_pass={{user_password}}

                        [webserver]
                        10.121.211.2
                        10.121.211.3

                        [bdd]
                        10.121.211.3
                        ```

                        Test de la connexion à mon inventaire
                        ```
                        ansible -i hosts -m ping all
                        ansible -i hosts -m ping admin
                        ```
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les playbooks et les tâches

                        * Une playbook représente un enchaînement d'actions à réaliser sur un ensemble de machine
                        * Elle est écrite au format YAML
                        * Elle s'éxecute de manière séquentielle
                        * Elle est constituée d'un ou plusieurs *plays*
                        * Chaque *play* est constitué d'une liste de tâches
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les playbooks et les tâches

                        TODO exemple de playbook / play + commande de lancement
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Modules

                        * Une tâche de la playbook a pour objectif l'éxecution d'un module

                        ```
                        - name: restart webserver
                          service:
                            name: httpd
                            state: restarted
                        ```
                        * Un module est idempotent en général
                        * Un module est écrit en python en général
                        * Ansible fournit un grand nombre de module par défaut
                        * Exemple de module : shell, user, group, authorized_key, template, copy ...
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Modules

                        * Un module peut être éxecuté directement par la commande ansible :

                        ```
                        ansible -i hosts -m service -a "name=httpd state=started" webserver
                        ansible -i hosts -m command -a "date" webserver
                        ```
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Autres concepts

                        - Role
                        - Variable
                        - Templating avec Jinja2
                        - Condition
                        - Boucle
                        - Blocks (v2)
                        - Stratégie (v2)
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les roles

                        * Permet d'organiser les playbooks
                        * Automatise le chargement de certains fichiers (vars_files, tasks, handlers ...)
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les roles

                        <pre class="stretch"><code data-trim>
                        .
                        +-- deploy.yml
                        +-- roles
                        +-- bdd_create
                        |   +-- files/
                        |   |   +-- **.*
                        |   +-- templates/
                        |   |   +-- **.j2
                        |   +-- tasks
                        |   |   +-- main.yml
                        |   +-- handlers
                        |   |   +-- main.yml
                        |   +-- vars
                        |   |   +-- main.yml
                        |   +-- defaults
                        |   |   +-- main.yml
                        |   +-- meta
                        |       +-- main.yml
                        +-- jboss_config
                        +-- **/*
                        </code></pre>
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les roles

                        * L'ensemble de l'arborescence n'est pas obligatoire (fichier non présent => fichier ignoré)
                        * Appel d'un role dans une playbook

                        ```
                        ---
                        - hosts: webservers
                        roles:
                        - common
                        - webservers
                        ```
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les variables

                        * Une variable permet de gérer les différences entre les systèmes
                        * Elles peuvent être définies à différents niveaux :
                        - au niveau de l'inventaire
                        - au niveau de la playbook
                        - au niveau de fichiers importés dans les playbooks
                        - au niveau d'un role
                        * Utilisation d'une variable dans Ansible :

                        ```
                        My amp goes to {{ max_amp_value }}
                        ```
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les variables

                        * Changement entre les versions 1.9 et 2.0
                        * Priorisation des variables (d'après la documentation Ansible officielle)

                        <!--```-->
                        <!--* extra vars (-e in the command line) always win-->
                        <!--* then comes connection variables defined in inventory-->
                        <!--(ansible_ssh_user, etc)-->
                        <!--* then comes "most everything else"-->
                        <!--(command line switches, vars in play, included vars, role vars, etc)-->
                        <!--* then comes the rest of the variables defined in inventory-->
                        <!--* then comes facts discovered about a system-->
                        <!--* then "role defaults",-->
                        <!--which are the most "defaulty" and lose in priority to everything.-->
                        <!--```-->
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Le templating avec Jinja2

                        TODO
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les conditions

                        TODO
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les boucles

                        TODO
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les blocks

                        Nouveauté dans le version 2.0

                        TODO
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Les stratégies

                        Nouveauté dans le version 2.0

                        TODO
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Arborescence typique d'un projet Ansible

                        <pre class="stretch"><code data-trim>
                            .
                            +-- group_vars
                            |   +-- all.yml
                            |   +-- requirement.yml
                            |   +-- webserver.yml
                            |   +-- bdd.yml
                            +-- host_vars
                            |   +-- 10.121.211.2.yml
                            +-- roles
                            |   +-- mes_roles/...
                            +-- vars
                            |   +-- commons.yml
                            |   +-- env.yml
                            +-- ansible.cfg
                            +-- hosts
                            +-- hosts_prerequis
                            +-- provisioning.yml
                            +-- deploy.yml
                            +-- prerequis.yml
                        </code></pre>
                    </script>
                </section>

                <section data-markdown>
                    <script type="text/template">
                        ## Ansibox pour le développeur:
                        ### Pourquoi est-ce peut être une bonne idée ?

                        - Un format YAML qui se rapproche d'une documentation
                        - Aller plus rapidement et plus sereinement en production => tester les scripts de deploiement le plus tôt
                        - Travailler main dans la main avec les OPS => mise en place d'une démarche DEVOPS
                        - Ansible via cygwin sur un poste de développeur windows
                        - Test unitaire avec RoleSpec
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Difficultés à surmonter

                        - Culture DEV et OPS

                                ils ne se comprennent pas tout le temps
                        - Role versus Module

                                tout le monde n'est pas à l'aise avec le Python
                        - Garder un minimum de roles communs

                                gestion des mots de passe, pré-requis systéme et
                                plus si affinitées
                        - Une gestion des environnements à mutualiser

                                DEV et OPS autour d'une même table
                    </script>
                </section>
                <section data-markdown data-background="images/ansible-docker.png" data-background-size="60%">
                    <script type="text/template">
                        ## Démo

                        Déploiement d'un cluster Mongodb avec Ansible dans des containes Docker
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Démo

                        TODO schema replica 0 uniquement
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Démo

                        TODO schema replica 0 et 1 + config + sharding
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Démo

                        TODO schema replica 0 et 1 + config + sharding
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Démo

                        - Explication du container Docker avec sshd
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Démo - TODO List

                        - Mise en place d'un cluster MongoDB (replica + shard)
                        - Installation des prérequis
                        - Mise en place du replica rs0
                        - Création d'un replica rs0
                        - Alimentation en données du replica => manuel
                        - Simulation coupure reseau => docker pause / docker unpause
                        - Simulation perte machine => docker rm -f / docker-compose scale
                        - Installation des prérequis
                        - Mise en place du sharding
                        - Création d'un replica rs1
                        - Création des serveurs de configuration
                        - Création du serveur de sharding
                        - Activation du sharding + creation index + sharding de la collection => manuel
                        - Supervision pendant les tests
                    </script>
                </section>
                <section data-markdown data-background="images/questions.jpg" data-background-size="40%">
                    <script type="text/template">
                        ## Questions

                    </script>
                </section>
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script>
			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				slideNumber: true,

				transition: 'none', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

			Reveal.configure({ slideNumber: 'h.v - c/t' })
		</script>
	</body>
</html>
